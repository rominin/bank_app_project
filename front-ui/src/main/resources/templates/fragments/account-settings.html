<div th:fragment="accountSettings">
  <h2>Настройки аккаунта</h2>

  <div>
    <p><strong>Логин:</strong> <span th:text="${username}"></span></p>

    <form th:action="@{/home/deleteProfile}" method="post">
      <button type="submit" onclick="return confirm('Вы уверены, что хотите удалить аккаунт?')">Удалить аккаунт</button>
      <p th:if="${deleteError}" th:text="${deleteError}" style="color: red;"></p>
    </form>
  </div>

  <hr/>

  <div>
    <form th:action="@{/home/change-password}" method="post">
      <div>
        <label for="newPassword">Новый пароль:</label>
        <input type="password" id="newPassword" name="newPassword" required>
      </div>
      <button type="submit">Изменить пароль</button>
      </form>
  </div>

  <div th:if="${passwordSuccess}" style="color: green;">
    <p th:text="${passwordSuccess}"></p>
  </div>
  <div th:if="${passwordError}" style="color: red;">
    <p th:text="${passwordError}"></p>
  </div>

  <hr/>

  <form th:action="@{/home/updateProfile}" method="post">
    <div>
      <label for="firstName">Имя:</label>
      <input type="text" id="firstName" name="firstName" th:value="${firstName}" required />
    </div>
    <div>
      <label for="lastName">Фамилия:</label>
      <input type="text" id="lastName" name="lastName" th:value="${lastName}" required />
    </div>
    <div>
      <label for="email">Почта:</label>
      <input type="email" id="email" name="email" th:value="${email}" required />
    </div>
    <div>
      <label for="birthDate">Дата рождения:</label>
      <input type="date" id="birthDate" name="birthDate" th:value="${birthDate}" required />
    </div>
    <button type="submit">Сохранить</button>

    <p th:if="${updateProfileSuccess}" style="color:green;">Профиль успешно обновлён!</p>
    <p th:if="${updateProfileError}" style="color:red;" th:text="${updateProfileError}"></p>
  </form>

  <hr/>

  <h3>Ваши счета</h3>
  <table>
    <thead>
    <tr>
      <th>ID</th>
      <th>Валюта</th>
      <th>Баланс</th>
      <th>Действия</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="account : ${accounts}">
      <td th:text="${account.id}"></td>
      <td th:text="${account.currency}"></td>
      <td th:text="${account.balance}"></td>
      <td>
        <form th:action="@{/home/accounts/delete}" method="post" style="display:inline">
          <input type="hidden" name="userId" th:value="${userId}" />
          <input type="hidden" name="currency" th:value="${account.currency}" />
          <button type="submit">Удалить</button>
        </form>

        <form th:action="@{/home/accounts/edit}" method="post" style="display:inline; margin-left: 10px;">
                    <input type="hidden" name="accountId" th:value="${account.id}" />
          <input type="hidden" name="userId" th:value="${userId}" />

          <select name="currency" required>
            <option value="RUB" th:selected="${account.currency == 'RUB'}">RUB</option>
            <option value="USD" th:selected="${account.currency == 'USD'}">USD</option>
            <option value="EUR" th:selected="${account.currency == 'EUR'}">EUR</option>
            <option value="CNY" th:selected="${account.currency == 'CNY'}">CNY</option>
          </select>

          <button type="submit">Обновить</button>
        </form>
      </td>
    </tr>
    </tbody>
  </table>
  <div th:if="${deleteAccountError}" class="error">
    <p th:text="${deleteAccountError}"></p>
  </div>

  <h3>Добавить счёт</h3>
  <form th:action="@{/home/accounts/add}" method="post">
    <input type="hidden" name="userId" th:value="${userId}" />

    <label for="currency">Валюта:</label>
    <select name="currency" id="currency" required>
      <option value="RUB">RUB</option>
      <option value="USD">USD</option>
      <option value="EUR">EUR</option>
      <option value="CNY">CNY</option>
    </select>

    <button type="submit">Добавить</button>
  </form>

  <div th:if="${addAccountError}" class="error">
    <p th:text="${addAccountError}"></p>
  </div>

  <hr/>

  <div>
    <a th:href="@{/perform-logout}">Выйти из аккаунта</a>
  </div>
</div>